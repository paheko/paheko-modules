{{* -*- brindille -*- *}}

{{:admin_header title="Configuration" current="module_equipment"}}

{{* barre de navigation *}}
{{:include file="../_nav.html" current="config" subcurrent="categories"}}

{{if $_GET.ok}}
	{{if $_GET.msg == "modification"}}
		<p class="block confirm">Modification enregistrée</p>
	{{elseif $_GET.msg == "suppression"}}
		<p class="block confirm">Catégorie supprimée</p>
	{{elseif $_GET.msg == "ajout"}}
		<p class="block confirm">Catégorie ajoutée</p>
	{{/if}}
{{elseif $_GET.err}}
	{{if $_GET.msg == "suppression"}}
		<p class="block error">
			Cette catégorie ne peut être supprimée car elle contient encore des matériels
		</p>
	{{/if}}
{{/if}}

{{* afficher les catégories déjà enregistrées *}}
<section class="categories">
	{{#list select="$$.name AS 'Catégorie'" order="1" where="$$.type = 'category'"}}
		{{:assign category_key=$key}}
		{{* voir s'il y a des matériels dans cette catégorie *}}
		{{:assign materiel_present=true}}
		{{#load type="equipment" where="$$.category = :category_key" :category_key=$category_key limit=1}}
		{{else}}
			{{:assign materiel_present=false}}
		{{/load}}
		<tr>
			<th>{{$name}}</th>
			<td class="actions">
				{{if ! $materiel_present}}
					{{:linkbutton label="Supprimer" href="delete_category.html?key=%s"|args:$key shape="delete" target="_dialog"}}
				{{/if}}
				{{:linkbutton label="Modifier" href="modify_category.html?key=%s"|args:$key shape="edit" target="_dialog"}}
			</td>
		</tr>
	{{else}}
		<p class="block alert">Il n'y a aucune catégorie : vous devez en ajouter.</p>
	{{/list}}
</section>

{{:admin_footer}}
