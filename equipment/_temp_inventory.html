{{* -*- brindille -*- *}}

{{*
	inventaire des entrées/sorties des matériels temporaires
*}}

{{* Sélecteur catégories *}}
{{:assign var="options." value="" label="Toutes les catégories" href="?prop=0"}}
{{#load type="category" order="$$.name"}}
	{{:assign var="categories.%s"|args:$key value=$name}}
	{{:assign
		var="options."
		value=$key
		label=$name
		href="?cat_key=%s&prop=0"|args:$key
	}}
{{/load}}

<fieldset class="shortFormRight">
	<legend>Filtrer par catégorie</legend>
	{{:dropdown
		title="Filtrer par catégorie"
		options=$options
		value="%s"|args:$_GET.cat_key
	}}
</fieldset>

<div class="shortFormLeft">
	<p class="help">Inventaire des matériels empruntés ou loués</p>
</div>

{{* filtrer selon la catégorie *}}
{{if $_GET.cat_key == null}}
	{{:assign condition="1"}}
{{else}}
	{{:assign cat_key=$_GET.cat_key|quote_sql}}
	{{:assign condition="$$.category = %s"|args:$cat_key}}
{{/if}}

{{#list
	select="
	$$.name AS 'Matériel' ;
	(SELECT $$.name
		FROM @TABLE as cat
		WHERE cat.key = @TABLE.$$.category) AS 'Catégorie' ;
	$$.notowned AS 'Quantité'
	"
	type="equipment"
	where="$$.status <> 'archived' AND $$.notowned != 0 AND %s"|args:$condition
	order=1
	}}
	{{:assign var=cat_name from=categories.%s|args:$category}}
	<tr>
		<td>{{:link href="equipment_history.html?key=%s&prop=0"|args:$key" label=$name}}</td>
		<td>{{$cat_name}}</td>
		<td class="num">{{$col3}}</td>
		<td class="actions">
			{{:linkbutton
			label="Entrée"
			shape="plus"
			href="movements/input_equipment.html?key=%s"|args:$key
			target="_dialog"}}
			{{:linkbutton
			label="Modifier"
			href="modify_equipment.html?key=%s&prop=0"|args:$key
			shape="edit"
			target="_dialog"}}
		</td>
	</tr>
{{else}}
	<p class="block alert">Aucun matériel.</p>
{{/list}}
